<html>
<head>
    <link rel="stylesheet" href="/libs/bootstrap.min.css">
    <script type="text/javascript" src="/libs/bootstrap-native-v4.min.js"></script>
    <script type="text/javascript" src="/libs/app.js"></script>
    <script type="text/javascript">
        'use strict';

        // Default Fetch Options
        var defaultFetchOptions = {
            headers: [
                [ 'Accept', 'application/json' ],
                [ 'Content-Type', 'application/json' ],
                [ 'Authorization', '' ]
            ]
        };
        $$.SetDefaultFetchOptions(defaultFetchOptions);

        // Manage Form Fields
        var forms = {};
        function onChange(input, form) {
            form = form ? form : input.form.id;
            if (!forms[form]) forms[form] = {};
            forms[form][input.name] = (input.type === "checkbox") ? input.value === "on" : input.value;
        }

        // Manage Login
        function onLogin(response) {
            defaultFetchOptions.headers[2] = [ 'Authorization', 'Bearer ' + response['token'] ];
            $$.SetDefaultFetchOptions(defaultFetchOptions);

            var html = '';
            response['hosts'].forEach(function(value){
                html += value.host;
                html += "<br>";
            });
            document.getElementById('hosts').innerHTML = html;
        }

        // Manage Execute
        function onExecute(response) {
            document.getElementById('stdout').innerHTML += response['out'];
            document.getElementById('stderr').innerHTML += response['err'];
        }

        // Click a Button
        function onClick(btn, url, form, callback) {
            var prevInnerHTML = btn.innerHTML;
            btn.innerHTML = 'Loading...';
            $$.Fetch(url, $$.OverrideDefaultFetchOptions({
                data: !form ? null : forms[form],
                onSuccess: !callback ? null : function(xhr) {
                    callback(JSON.parse(xhr.response));
                },
                onFailure: function(xhr, uri) {
                    console.log(uri + " :: failure :: " + xhr.response);
                },
                onComplete: function() {
                    btn.innerHTML = prevInnerHTML;
                }
            }));
        }
    </script>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <div class="col">
                <form id="login" action="#login" onsubmit="return false">
                    <div class="form-group">
                        <label for="loginUsername">Username</label>
                        <input type="text" class="form-control" id="loginUsername" name="username" placeholder="Username" value="adminy" onchange="onChange(this, 'login')">
                    </div>
                    <div class="form-group">
                        <label for="loginPassword">Password</label>
                        <input type="password" class="form-control" id="loginPassword" name="password" placeholder="Password" value="adminy" onchange="onChange(this, 'login')">
                    </div>
                    <button type="submit" onclick="onClick(this, '/login', 'login', onLogin)" class="btn btn-primary">
                        Login
                    </button>
                </form>
            </div>
            <div class="col">
                <form id="addhost" action="#addhost" onsubmit="return false">
                    <div class="form-group">
                        <label for="host">Host</label>
                        <input type="text" class="form-control" id="host" name="host" placeholder="Host" value="cloud02.calebgray.com:2222" onchange="onChange(this, 'addhost')">
                    </div>
                    <div class="form-group">
                        <label for="addhostUsername">Username</label>
                        <input type="text" class="form-control" id="addhostUsername" name="username" placeholder="Username" value="rooty" onchange="onChange(this, 'addhost')">
                    </div>
                    <div class="form-group">
                        <label for="addhostPassword">Password</label>
                        <input type="password" class="form-control" id="addhostPassword" name="password" placeholder="Password" onchange="onChange(this, 'addhost')">
                    </div>
                    <div class="form-group">
                        <label for="publicKey">Public Key</label>
                        <input type="text" class="form-control" id="publicKey" name="publicKey" placeholder="Public Key" onchange="onChange(this, 'addhost')">
                    </div>
                    <div class="form-group">
                        <input type="checkbox" class="form-control" id="autoConnect" name="autoConnect" onchange="onChange(this, 'addhost')">
                        <label for="autoConnect">Automatically Connect</label>
                    </div>
                    <button type="submit" onclick="onClick(this, '/addhost', 'addhost')" class="btn btn-primary">
                        Add Host
                    </button>
                </form>
            </div>
            <div class="col">
                <form id="execute" action="#execute" onsubmit="return false">
                    <div class="form-group">
                        <label for="executeId">Id</label>
                        <input type="text" class="form-control" id="executeId" name="id" placeholder="Id" value="00" onchange="onChange(this, 'execute')">
                    </div>
                    <div class="form-group">
                        <label for="executeCommand">Command</label>
                        <input type="text" class="form-control" id="executeCommand" name="command" placeholder="Command" value="lss" onchange="onChange(this, 'execute')">
                    </div>
                    <button type="submit" onclick="onClick(this, '/execute', 'execute')" class="btn btn-primary">
                        Execute
                    </button>
                </form>
            </div>
            <div class="col">
                <form id="poll" action="#poll" onsubmit="return false">
                    <div class="form-group">
                        <label for="pollId">Id</label>
                        <input type="text" class="form-control" id="pollId" name="id" placeholder="Id" value="00" onchange="onChange(this, 'poll')">
                    </div>
                    <button type="submit" onclick="onClick(this, '/poll', 'poll', onExecute)" class="btn btn-primary">
                        Poll
                    </button>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col">
                <div id="hosts"></div>
            </div>
            <div class="col">
                <pre id="stdout"></pre>
            </div>
            <div class="col">
                <pre id="stderr"></pre>
            </div>
        </div>
    </div>
</body>
</html>